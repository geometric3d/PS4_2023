\documentclass[11pt,addpoints,answers]{exam}
\usepackage[margin=1in]{geometry}
\usepackage{amsmath, amsfonts}
\usepackage{enumerate}
\usepackage{graphicx}
\usepackage{titling}
\usepackage{url}
\usepackage{xfrac}
\usepackage{geometry}
\usepackage{graphicx}
\usepackage{natbib}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{paralist}
\usepackage{epstopdf}
\usepackage{tabularx}
\usepackage{longtable}
\usepackage{multirow}
\usepackage{multicol}
\usepackage[colorlinks=true,urlcolor=blue]{hyperref}
\usepackage{fancyvrb}
\usepackage{algorithm}
\usepackage{algorithmic}
\usepackage{float}
\usepackage{paralist}
\usepackage[svgname]{xcolor}
\usepackage{enumerate}
\usepackage{array}
\usepackage{times}
\usepackage{url}
\usepackage{comment}
\usepackage{environ}
\usepackage{times}
\usepackage{textcomp}
\usepackage{caption}
\usepackage[colorlinks=true,urlcolor=blue]{hyperref}
\usepackage{listings}
\usepackage{parskip} % For NIPS style paragraphs.
\usepackage[compact]{titlesec} % Less whitespace around titles
\usepackage[inline]{enumitem} % For inline enumerate* and itemize*
\usepackage{datetime}
\usepackage{comment}
% \usepackage{minted}
\usepackage{lastpage}
\usepackage{color}
\usepackage{xcolor}
\usepackage{listings}
\usepackage{tikz}
\usetikzlibrary{shapes,decorations,bayesnet}
%\usepackage{framed}
\usepackage{booktabs}
\usepackage{cprotect}
\usepackage{xcolor}
\usepackage{verbatimbox}
\usepackage[many]{tcolorbox}
\usepackage{cancel}
\usepackage{wasysym}
\usepackage{mdframed}
\usepackage{subcaption}
\usetikzlibrary{shapes.geometric}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Formatting for \CorrectChoice of "exam" %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\CorrectChoiceEmphasis{}
\checkedchar{\blackcircle}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Better numbering                        %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\numberwithin{equation}{section} % Number equations within sections (i.e. 1.1, 1.2, 2.1, 2.2 instead of 1, 2, 3, 4)
\numberwithin{figure}{section} % Number figures within sections (i.e. 1.1, 1.2, 2.1, 2.2 instead of 1, 2, 3, 4)
\numberwithin{table}{section} % Number tables within sections (i.e. 1.1, 1.2, 2.1, 2.2 instead of 1, 2, 3, 4)


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Common Math Commands                    %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\input{mathabbreviations.tex}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Code highlighting with listings         %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\definecolor{bluekeywords}{rgb}{0.13,0.13,1}
\definecolor{greencomments}{rgb}{0,0.5,0}
\definecolor{redstrings}{rgb}{0.9,0,0}
\definecolor{light-gray}{gray}{0.95}

\newcommand{\MYhref}[3][blue]{\href{#2}{\color{#1}{#3}}}%

\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\lstdefinelanguage{Shell}{
  keywords={tar, cd, make},
  %keywordstyle=\color{bluekeywords}\bfseries,
  alsoletter={+},
  ndkeywords={python, py, javac, java, gcc, c, g++, cpp, .txt, octave, m, .tar},
  %ndkeywordstyle=\color{bluekeywords}\bfseries,
  identifierstyle=\color{black},
  sensitive=false,
  comment=[l]{//},
  morecomment=[s]{/*}{*/},
  commentstyle=\color{purple}\ttfamily,
  stringstyle=\color{red}\ttfamily,
  morestring=[b]',
  morestring=[b]",
  backgroundcolor = \color{light-gray}
}

\lstset{columns=fixed, basicstyle=\ttfamily,
    backgroundcolor=\color{light-gray},xleftmargin=0.5cm,frame=tlbr,framesep=4pt,framerule=0pt}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Custom box for highlights               %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Define box and box title style
\tikzstyle{mybox} = [fill=blue!10, very thick,
    rectangle, rounded corners, inner sep=1em, inner ysep=1em]

% \newcommand{\notebox}[1]{
% \begin{tikzpicture}
% \node [mybox] (box){%
%     \begin{minipage}{\textwidth}
%     #1
%     \end{minipage}
% };
% \end{tikzpicture}%
% }

\NewEnviron{notebox}{
\begin{tikzpicture}
\node [mybox] (box){
    \begin{minipage}{\textwidth}
        \BODY
    \end{minipage}
};
\end{tikzpicture}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Commands showing / hiding solutions     %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% To HIDE SOLUTIONS (to post at the website for students), set this value to 0: \def\issoln{0}
\def\issoln{0}
% Some commands to allow solutions to be embedded in the assignment file.
\ifcsname issoln\endcsname \else \def\issoln{0} \fi
% Default to an empty solutions environ.
\NewEnviron{soln}{}{}
% Default to an empty qauthor environ.
\NewEnviron{qauthor}{}{}
% Default to visible (but empty) solution box.
\newtcolorbox[]{studentsolution}[1][]{%
    breakable,
    enhanced,
    colback=white,
    title=Solution,
    #1
}

\if\issoln 1
% Otherwise, include solutions as below.
\RenewEnviron{soln}{
    \leavevmode\color{red}\ignorespaces
    \textbf{Solution} \BODY
}{}
\fi

\if\issoln 1
% Otherwise, include solutions as below.
\RenewEnviron{solution}{}
\fi

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Commands for customizing the assignment %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\courseNum}{\href{https://geometric3d.github.io}{16822}}
\newcommand{\courseName}{\href{https://geometric3d.github.io}{Geometry-based Methods in Vision}}
\newcommand{\courseSem}{\href{https://geometric3d.github.io}{Fall 2023}}
\newcommand{\courseUrl}{\url{https://piazza.com/cmu/fall2023/16822}}
\newcommand{\hwNum}{Problem Set 4}
\newcommand{\hwTopic}{N-view Geometry}
\newcommand{\hwName}{\hwNum: \hwTopic}
\newcommand{\outDate}{Oct. 31, 2023}
\newcommand{\dueDate}{Nov. 09, 2023 11:59 PM}
\newcommand{\instructorName}{Shubham Tulsiani}
\newcommand{\taNames}{Ben Eisner, Nupur Kumari}

%\pagestyle{fancyplain}
\lhead{\hwName}
\rhead{\courseNum}
\cfoot{\thepage{} of \numpages{}}

\title{\textsc{\hwName}} % Title


\author{}

\date{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Useful commands for typesetting the questions %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand \expect {\mathbb{E}}
\newcommand \mle [1]{{\hat #1}^{\rm MLE}}
\newcommand \map [1]{{\hat #1}^{\rm MAP}}
\newcommand \argmax {\operatorname*{argmax}}
\newcommand \argmin {\operatorname*{argmin}}
\newcommand \code [1]{{\tt #1}}
\newcommand \datacount [1]{\#\{#1\}}
\newcommand \ind [1]{\mathbb{I}\{#1\}}

\newcommand{\blackcircle}{\tikz\draw[black,fill=black] (0,0) circle (1ex);}
\renewcommand{\circle}{\tikz\draw[black] (0,0) circle (1ex);}

\newcommand{\pts}[1]{\textbf{[#1 pts]}}

%%%%%%%%%%%%%%%%%%%%%%%%%%
% Document configuration %
%%%%%%%%%%%%%%%%%%%%%%%%%%

% Don't display a date in the title and remove the white space
\predate{}
\postdate{}
\date{}

%%%%%%%%%%%%%%%%%%
% Begin Document %
%%%%%%%%%%%%%%%%%%


\begin{document}

\section*{}
\begin{center}
  \textsc{\LARGE \hwNum} \\
%   \textsc{\LARGE \hwTopic\footnote{Compiled on \today{} at \currenttime{}}} \\
  \vspace{1em}
  \textsc{\large \courseNum{} \courseName{} (\courseSem)} \\
  %\vspace{0.25em}
  \courseUrl\\
  \vspace{1em}
  OUT: \outDate \\
  DUE: \dueDate \\
  Instructor: \instructorName \\
  TAs: \taNames
\end{center}

\section*{START HERE: Instructions}
\begin{itemize}
    \item \textbf{Collaboration policy:} All are encouraged to work together, BUT you must do your own work (code and write up). If you work with someone, please include their name in your write-up and cite any code that has been discussed. If we find highly identical write-ups or code without proper accreditation of collaborators, we will take action according to university policies, i.e., you will likely fail the course. See the \href{https://www.dropbox.com/s/z6o0tinc9eaez46/L01_Overview.pdf?dl=0}{Academic Integrity Section} detailed in the initial lecture for more information.
          \item\textbf{Submitting your work:}
          \begin{itemize}
              \item We will be using Gradescope (\url{https://gradescope.com/}) to submit the Problem Sets. Please use the provided template. Submissions can be written in LaTeX, or submitted as a scanned PDF. Regrade requests can be made, however, this gives the TA the opportunity to regrade your entire paper, meaning if additional mistakes are found, then points will be deducted.
                    Each derivation/proof should be  completed on a separate page. For short answer questions, you \textbf{should} include your work in your solution.
              \item For questions where you must fill in a blank, please make sure your final answer is fully included in the given space. You may cross out answers or parts of answers, but the final answer must still be within the given space. We accept either LaTex PDFs or scanned documents as long as the location of each question is annotated properly.

          \end{itemize}
    \item \textbf{Materials:} The data that you will need in order to complete this assignment is posted along with the write-up and template on Piazza.
\end{itemize}


\clearpage

\section{Auto-calibration [20 pts]}
\begin{questions}

\question \textbf{[16 pts]} How many images are required to compute a metric rectification in each of the following scenarios (please give brief 1-2 line explanations):

(a) The principal point in all images is known to be at $(0,0)$.

(b) The cameras have zero skew.

(c) The principal point in all images is known to be at $(0,0)$, and the cameras have zero skew.

(d)  Camera intrinsics are known for all cameras.

(e) Camera instrinsics for each camera are of the form
$
\begin{bmatrix}
f & 0 & 0 \\
0 & f & 0 \\
0 & 0 & 0
\end{bmatrix}$, but each camera can have a different and unknown focal length.

(f) The intrinsics across all cameras are known to be the same.

(g) (2pts) The intrinsics across all cameras are known to be the same and the plane at infinity is known in the 3D reconstruction.

\begin{tcolorbox}[fit,height=11cm, width=\textwidth, blank, borderline={0.5pt}{-2pt},halign=left, valign=center, nobeforeafter]

\end{tcolorbox}

\newpage

\question \textbf{[4 pts]} To recover a metric rectification, we need to compute a Homography $H$ of the form $\begin{bmatrix}
K_1 & \mathbf{0} \\
\mathbf{v}^{\mathsf{T}} & 0 \\
\end{bmatrix}$. Defining $A=\begin{bmatrix}
K_1 \\
\mathbf{v}^{\mathsf{T}} \\
\end{bmatrix}$, our strategy is to first determine $L=A^{\mathsf{T}}A$ using constraints on intrinsic matrices, and then recover A. Given $L$, outline the approach for computing $A$.

\begin{tcolorbox}[fit,height=4.5cm, width=\textwidth, blank, borderline={0.5pt}{-2pt},halign=left, valign=center, nobeforeafter]

\end{tcolorbox}

\section{Non-linear Least Squares [8 pts]}

\question \textbf{[8 pts]} Are these statements true or false?  

(a) Gauss-Newton method is a second-order optimization method.

(b) If we optimize $\min_\xv \|A\xv-\bv\|^2$ using Gauss-Newton, we will find the global optima in a single iteration. 

(c) Gauss-Newton optimization can be used for minimizing any cost function $\min_{\xv} C(\xv)$.

(d) When performing bundle adjustment, we have an objective that is typically of the form of multiple re-projection errors measuring the difference between the observed and re-projected 2D coordinates: $L = \sum \| \xv^{obs}_{n} - \xv^{proj}_n \|$, where this optimization is iteratively performed via a algorithm like Gauss-Newton. Is the following statement true or false -- if we  add a (positive) weight associated with each error i.e. $L = w_n \sum \| \xv^{obs}_{n} - \xv^{proj}_n \|$, then we can no longer use Gauss-Newton to optimize this objective.

\begin{tcolorbox}[fit,height=5cm, width=\textwidth, blank, borderline={0.5pt}{-2pt},halign=left, valign=center, nobeforeafter]


\end{tcolorbox}

\newpage

\section{Trifocal Tensor [10 pts]}

\question \textbf{[4 pts]} Are these statements true or false?  

(a) The trifocal tensor corresponding to the triplet of cameras $(P, P', P'')$ is the same as the trifocal tensor for $(PH, P'H, P''H)$, where $H$ is any invertible matrix.

(b) Assuming $\Tv = [\Tv_1, \Tv_2, \Tv_3]$ is the trifocal tensor for $(P, P', P'')$, then $ \Tv_1^{\mathsf{T}}, \Tv_2^{\mathsf{T}}, \Tv_3^{\mathsf{T}}$ is the trifocal tensor for $(P, P'', P')$. 

\begin{tcolorbox}[fit,height=2cm, width=\textwidth, blank, borderline={0.5pt}{-2pt},halign=left, valign=center, nobeforeafter]


\end{tcolorbox}

\question \textbf{[6 pts]} Let us assume that $\Tv = [\Tv_1, \Tv_2, \Tv_3]$ is the trifocal tensor for $(P, P', P'')$. We then transform the camera $P''$ to $\bar{P}''$ by rotating it in place by $R$ (i.e. camera center and intrinsics $K''$ are unchanged). Find the trifocal tensfor for the triplet $(P, P', \bar{P}'')$ in terms of $ [\Tv_1, \Tv_2, \Tv_3], K, R$.

\begin{tcolorbox}[fit,height=4cm, width=\textwidth, blank, borderline={0.5pt}{-2pt},halign=left, valign=center, nobeforeafter]


\end{tcolorbox}

\section{Structure from Motion [12 pts]}

\question \textbf{[6 pts]} Are these statements true or false?  

(a) Given sufficient images of a static scene with accurate correspondences, one can recover a metric reconstruction of the underlying scene.

(b) When performing Hierarchical SfM, we first obtain independent reconstructions across clusters and then align them. If we know camera intrinsics for all cameras, two independently reconstructed clusters would need to be aligned via a euclidean transform.

(c) When performing incremental SfM, the initial two cameras selected for bootstrapping should ideally correspond to the closest possible pair.

\begin{tcolorbox}[fit,height=3cm, width=\textwidth, blank, borderline={0.5pt}{-2pt},halign=left, valign=center, nobeforeafter]


\end{tcolorbox}

\newpage

\question \textbf{[6 pts]} Affine Triangulation: Assuming known affine cameras $\{\Pv_n\}$ and observed projections $\{\xv_n\}$ for an (unknown) 3D point $\Xv$, describe an algorithm to compute $\Xv$ that minimizes the sum of squared reprojection error across all cameras.

\begin{tcolorbox}[fit,height=6cm, width=\textwidth, blank, borderline={0.5pt}{-2pt},halign=left, valign=center, nobeforeafter]


\end{tcolorbox}


\end{questions}

\clearpage

\textbf{Attendance Question:} Among Lectures 16-19, how many did you attend in person?

\begin{tcolorbox}[fit,height=1cm,blank, borderline={1pt}{-2pt},nobeforeafter]
    %Input your solution here.  Do not change any of the specifications of this solution box.
\end{tcolorbox}


    
\textbf{Collaboration Questions} Please answer the following:

\begin{enumerate}
    \item Did you receive any help whatsoever from anyone in solving this assignment?
    \begin{checkboxes}
     \choice Yes
     \choice No
    \end{checkboxes}
    \begin{itemize}
        \item If you answered `Yes', give full details:
        \item (e.g., “Jane Doe explained to me what is asked in Question 3.4”)
    \end{itemize}

    \begin{tcolorbox}[fit,height=2cm,blank, borderline={1pt}{-2pt},nobeforeafter]
    %Input your solution here.  Do not change any of the specifications of this solution box.
    \end{tcolorbox}

    \item Did you give any help whatsoever to anyone in solving this assignment?
    \begin{checkboxes}
     \choice Yes
     \choice No
    \end{checkboxes}
    \begin{itemize}
        \item If you answered `Yes', give full details:
        \item (e.g. “I pointed Joe Smith to section 2.3 since he didn’t know how to proceed with Question 2”)
    \end{itemize}

    \begin{tcolorbox}[fit,height=2cm,blank, borderline={1pt}{-2pt},nobeforeafter]
    %Input your solution here.  Do not change any of the specifications of this solution box.
    \end{tcolorbox}

    \item Did you find or come across code that implements any part of this assignment ? 
    \begin{checkboxes}
     \choice Yes
     \choice No
    \end{checkboxes}
    \begin{itemize}
        \item If you answered `Yes', give full details: \underline{No}
        \item (book \& page, URL \& location within the page, etc.).
    \end{itemize}
    \begin{tcolorbox}[fit,height=2cm,blank, borderline={1pt}{-2pt},nobeforeafter]
    %Input your solution here.  Do not change any of the specifications of this solution box.
    \end{tcolorbox}
\end{enumerate}

\end{document}